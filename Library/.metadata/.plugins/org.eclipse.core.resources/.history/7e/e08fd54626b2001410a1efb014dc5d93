package baseaspects;

import umjdt.contexts.Context;
import umjdt.contexts.ContextController;
import utilities.*;
import java.io.Serializable;
import umjdt.util.LockType;
import umjdt.util.Semaphore;


public aspect ContextParticipantAspect 
{	
	declare parents: Participant implements Serializable;

	private Context Participant.currentContext;
	
	public void Participant.setCurrentContext(Context context)
	{
		String name = "";	
		if(null != context){name = context.getName();}
		else{
				name = "No Context";
			}
		currentContext = context;
	}
	
	public Context Participant.getCurrentContext()
	{	
		return currentContext;
	}
	
	public synchronized void Participant.createContext(String name, String contextPath)
	{
		//The participant is willing to create a context named
		Context context = ContextController.createContext(name,contextPath);
		
		Debugger.printMessage("ContextParticipant",Debugger.PARTICIPANT_ASPECT,this,"The participant is done creating the context named -" + name + "-.\n",2);
		
		Debugger.printMessage("ContextParticipant",Debugger.PARTICIPANT_ASPECT,this,"The participant will become a part of the context named -" + name + "-.",2);
		
		context.assignParticipant(this);
		
		Debugger.printMessage("ContextParticipant",Debugger.PARTICIPANT_ASPECT,this,"The participant has become a part of the context named -" + name + "-.\n",1);	
	}
	
	public void ContextParticipant.leaveContext()
	{
		String name = getCurrentContext().getName();
		
		Debugger.printMessage("ContextParticipant",Debugger.PARTICIPANT_ASPECT,this,"The participant is willing to leave its context named -" + name + "-.",2);
		
		getCurrentContext().dismissParticipant(this);
		
		Debugger.printMessage("ContextParticipant",Debugger.PARTICIPANT_ASPECT,this,"The participant has left its context named -" + name + "-.\n",2);
	}
	//	 Interface Methods //
	
	
	// The exception handling is not yet integrated into AspectOPTIMA
	// Therefore, for now ContextParticipant is responsible for handling exception signals..
	public void ContextParticipant.receiveTerminationSignal(String message)
	{
		throw new ContextTerminatedException(message);
	}
	
}
